{% extends 'base.html' %}
{% load static %}

{% block main %}
    <main>
        <table>
            <tr>
                <td>修改密码</td>
                <td>
                    <form method="post" enctype="multipart/form-data"
                          action="{% url 'SettingsHandle' mode='password' %}" class="settings-form" data-state="view">
                        {% csrf_token %}
                        <input type="password" name="password1" placeholder="新密码" class="input-field" disabled>
                        <input type="password" name="password2" placeholder="确认新密码" class="input-field" disabled>
                        <button type="button" class="toggle-btn">修改</button>
                        <button type="submit" class="submit-btn" hidden>保存</button>
                    </form>
                    {% if password_message %}
                        <p>{{ password_message }}</p>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>更换头像</td>
                <td>
                    <form method="post" enctype="multipart/form-data" action="{% url 'SettingsHandle' mode='avatar' %}"
                          class="settings-form" data-state="view">
                        {% csrf_token %}
                        <input type="file" name="avatar" class="input-field" disabled>
                        <button type="button" class="toggle-btn">修改</button>
                        <button type="submit" class="submit-btn" hidden>保存</button>
                    </form>
                    {% if avatar_message %}
                        <p>{{ avatar_message }}</p>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>当前个性签名
                </td>
                <td>
                    {{ user.bio }}
                </td>
            </tr>
            <tr>
                <td>更换个人签名</td>
                <td>
                    <form method="post" enctype="multipart/form-data"
                          action="{% url 'SettingsHandle' mode='signature' %}" class="settings-form" data-state="view">
                        {% csrf_token %}
                        <input type="text" name="signature" placeholder="个人签名" class="input-field" disabled>
                        <button type="button" class="toggle-btn">修改</button>
                        <button type="submit" class="submit-btn" hidden>保存</button>
                    </form>
                    {% if signature_message %}
                        <p>{{ signature_message }}</p>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>注销账号</td>
                <td>
                    <form action="{% url 'deregister' %}" method="post">
                        {% csrf_token %}
                        <button type="button" class="deregister-btn" id="deregister-btn">注销账号</button>
                        <button type="submit" class="submit-btn" id="confirm-btn" style="display: none">确认注销
                        </button>
                        <button type="button" class="deregister-btn" id="cancel-btn" style="display: none">取消</button>
                    </form>
                </td>
            </tr>
        </table>
        <script>

            document.querySelectorAll('.toggle-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const form = this.closest('form');
                    const inputFields = form.getElementsByClassName('input-field'); // 移除点号
                    const submitBtn = form.querySelector('.submit-btn');
                    const toggleBtn = form.querySelector('.toggle-btn');

                    if (form.dataset.state === 'view') {
                        Array.from(inputFields).forEach(inputField => { // 使用 Array.from 将 HTMLCollection 转换为数组
                            inputField.disabled = false;
                        });
                        submitBtn.hidden = false;
                        toggleBtn.textContent = '取消';
                        form.dataset.state = 'edit';
                    } else {
                        Array.from(inputFields).forEach(inputField => { // 使用 Array.from 将 HTMLCollection 转换为数组
                            inputField.disabled = true;
                        });
                        submitBtn.hidden = true;
                        toggleBtn.textContent = '修改';
                        form.dataset.state = 'view';
                    }
                });
            });
            $(document).ready(function () {
                // 页面加载时隐藏取消按钮
                $('#cancel-btn').hide();

                // 注册按钮点击事件
                $('#deregister-btn').click(function () {
                    $('#confirm-btn').show();
                    $('#cancel-btn').show();
                });

                // 取消按钮点击事件
                $('#cancel-btn').click(function () {
                    $('#confirm-btn').hide();
                    $('#cancel-btn').hide();
                });
            });
        </script>
    </main>
{% endblock %}